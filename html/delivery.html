<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flash Rider App</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Roboto, sans-serif;}
body{background:#f0f2f5;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden;}
.phone-frame{width:100%;max-width:450px;height:100vh;background:#fff;position:relative;box-shadow:0 0 20px rgba(0,0,0,0.1);}

/* Login & Signup */
#login-page,#signup-page{display:flex;flex-direction:column;padding:40px 30px;height:100%;justify-content:center;text-align:center;background:#fff;}
#signup-page{display:none;}
.logo-area{width:80px;height:80px;background:#000;color:#fff;border-radius:22px;display:flex;justify-content:center;align-items:center;font-size:40px;margin:0 auto 20px;}
h2{font-size:26px;font-weight:bold;margin-bottom:5px;color:#1e272e;}
p{font-size:14px;color:#555;margin-bottom:15px;}
.input-box{width:100%;padding:16px;margin-bottom:15px;border:1px solid #eee;border-radius:12px;background:#f9f9f9;outline:none;font-size:16px;transition:0.3s;}
.input-box:focus{border-color:#000;}
.primary-btn{width:100%;padding:16px;background:#000;color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:bold;cursor:pointer;margin-top:10px;}
.primary-btn:hover{background:#333;}
.signup-text{margin-top:20px;font-size:13px;color:#888;}
.signup-text a{color:#000;font-weight:bold;text-decoration:none;cursor:pointer;}

/* Rider Main App */
#main-app{display:none;height:100%;flex-direction:column;}
header{padding:15px;display:flex;justify-content:space-between;align-items:center;position:absolute;top:0;width:100%;z-index:10;}
.header-btn{background:white;padding:10px;border-radius:50%;box-shadow:0 2px 5px rgba(0,0,0,0.1);width:40px;height:40px;display:flex;justify-content:center;align-items:center;}
.header-status{font-weight:bold;background:white;padding:5px 20px;border-radius:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
#map{flex:1;width:100%;height:60%;}
.orders-list{height:40%;overflow-y:auto;padding:10px;}
.order-card{background:#f8f8f8;padding:12px;margin-bottom:10px;border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.order-card p{margin-bottom:6px;font-size:14px;}
.order-buttons{display:flex;justify-content:space-between;}
.order-buttons button{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;}
.accept-btn{background:#4cd964;color:white;}
.reject-btn{background:#ff3b30;color:white;}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<div class="phone-frame">
    <!-- Login -->
    <div id="login-page">
        <div class="logo-area"><i class="fas fa-bolt"></i></div>
        <h2>Rider Login</h2>
        <input type="email" id="loginEmail" class="input-box" placeholder="Email">
        <input type="password" id="loginPassword" class="input-box" placeholder="Password">
        <button class="primary-btn" onclick="login()">Login</button>
        <p class="signup-text">New here? <a onclick="showSignUp()">Sign Up</a></p>
    </div>

    <!-- Sign Up -->
    <div id="signup-page">
        <div class="logo-area"><i class="fas fa-bolt"></i></div>
        <h2>Create Rider Account</h2>
        <input type="text" id="signupName" class="input-box" placeholder="Full Name">
        <input type="email" id="signupEmail" class="input-box" placeholder="Email">
        <input type="password" id="signupPassword" class="input-box" placeholder="Password">
        <button class="primary-btn" onclick="signUp()">Sign Up</button>
        <p class="signup-text"><a onclick="showLogin()">Back to Login</a></p>
    </div>

    <!-- Rider Main App -->
    <div id="main-app">
        <header>
            <div class="header-btn"><i class="fas fa-user"></i></div>
            <div class="header-status">Pending Orders</div>
            <div class="header-btn"><i class="fas fa-sign-out-alt" onclick="logout()"></i></div>
        </header>
        <div id="map"></div>
        <div class="orders-list" id="ordersList"></div>
    </div>
</div>

<script>
/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyA1tAW0DWW633uYOZ1cHw-kfnHL2kQrlNM",
  authDomain: "gobike-14050.firebaseapp.com",
  projectId: "gobike-14050",
  storageBucket: "gobike-14050.appspot.com",
  messagingSenderId: "1079730742000",
  appId: "1:1079730742000:web:2ba453b89870404fcc1835"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* Page Switch */
function showApp(){document.getElementById('login-page').style.display='none';document.getElementById('signup-page').style.display='none';document.getElementById('main-app').style.display='flex';loadOrders();}
function showSignUp(){document.getElementById('login-page').style.display='none';document.getElementById('signup-page').style.display='flex';}
function showLogin(){document.getElementById('signup-page').style.display='none';document.getElementById('login-page').style.display='flex';}

/* Auth */
function login(){
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if(!email||!password){alert("Fill all fields");return;}
    auth.signInWithEmailAndPassword(email,password)
    .then(res=> db.collection('users').doc(res.user.uid).get())
    .then(doc=>{
        if(!doc.exists) throw new Error("User not found");
        if(doc.data().role!=='rider') alert("Not a rider account!");
        else showApp();
    }).catch(err=>alert(err.message));
}

function signUp(){
    const name=document.getElementById('signupName').value.trim();
    const email=document.getElementById('signupEmail').value.trim();
    const password=document.getElementById('signupPassword').value.trim();
    if(!name||!email||!password){alert("Fill all fields");return;}
    auth.createUserWithEmailAndPassword(email,password)
    .then(res=> db.collection('users').doc(res.user.uid).set({
        name:name, email:email, role:'rider', createdAt:firebase.firestore.FieldValue.serverTimestamp()
    }))
    .then(()=>{alert("Sign Up Success"); showLogin();})
    .catch(err=>alert(err.message));
}

function logout(){auth.signOut().then(()=>location.reload());}

/* Leaflet Map */
let map, pickupMarker, dropMarker;
function initMap(lat=16.8661,lng=96.1951){ // Default Yangon
    map=L.map('map').setView([lat,lng],13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
}

/* Load Orders */
function loadOrders(){
    initMap();
    const ordersList=document.getElementById('ordersList');
    ordersList.innerHTML="";
    db.collection('orders').where("status","==","pending").onSnapshot(snapshot=>{
        ordersList.innerHTML="";
        snapshot.forEach(doc=>{
            const order=doc.data();
            const orderId=doc.id;
            const card=document.createElement('div'); card.className='order-card';
            card.innerHTML=`<p><b>Pickup:</b> ${order.pickup}</p>
            <p><b>Drop-off:</b> ${order.dropoff}</p>
            <div class="order-buttons">
                <button class="accept-btn" onclick="acceptOrder('${orderId}','${order.pickup}','${order.dropoff}')">Accept</button>
                <button class="reject-btn" onclick="rejectOrder('${orderId}')">Reject</button>
            </div>`;
            ordersList.appendChild(card);
        });
    });
}

/* Accept / Reject Orders */
function acceptOrder(id,pickup,dropoff){
    db.collection('orders').doc(id).update({status:'accepted'})
    .then(()=>{
        alert("Order Accepted");
        if(pickupMarker) map.removeLayer(pickupMarker);
        if(dropMarker) map.removeLayer(dropMarker);
        const p=pickup.split(',').map(Number);
        const d=dropoff.split(',').map(Number);
        pickupMarker=L.marker(p).addTo(map).bindPopup("Pickup Location").openPopup();
        dropMarker=L.marker(d).addTo(map).bindPopup("Drop-off Location").openPopup();
        map.fitBounds([p,d]);
    });
}

function rejectOrder(id){db.collection('orders').doc(id).update({status:'rejected'}).then(()=>alert("Order Rejected"));}
</script>

</body>
</html>
