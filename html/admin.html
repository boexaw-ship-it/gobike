<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - GoBike</title>
<link rel="stylesheet" href="../css/style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="../js/firebase-config.js"></script>
</head>
<body>
<div class="app">
<h2>Admin Dashboard</h2>
<div id="orders"></div>
</div>

<script>
auth.onAuthStateChanged(user=>{
  if(!user) location.href="../index.html";
  db.collection("users").doc(user.uid).get().then(doc=>{
    if(!doc.exists||doc.data().role!=="admin"){ auth.signOut(); location.href="../index.html"; }
  });

  const ordersDiv=document.getElementById("orders");
  db.collection("orders").where("status","==","pending").onSnapshot(snapshot=>{
    ordersDiv.innerHTML="";
    snapshot.docs.forEach(doc=>{
      const o=doc.data();
      const div=document.createElement("div");
      div.style.border="1px solid #ccc"; div.style.padding="5px"; div.style.margin="5px 0";
      div.innerHTML=`<b>Customer:</b> ${o.customerId}<br>
                     <b>Pickup:</b> ${o.pickup.lat.toFixed(5)},${o.pickup.lng.toFixed(5)}<br>
                     <b>Drop:</b> ${o.drop.lat.toFixed(5)},${o.drop.lng.toFixed(5)}<br>
                     <b>Price:</b> ${o.price} Ks<br>`;
      const btn=document.createElement("button");
      btn.innerText="Approve";
      btn.onclick=()=>{ db.collection("orders").doc(doc.id).update({status:"approved"}); };
      div.appendChild(btn);
      ordersDiv.appendChild(div);
    });
  });
});
</script>
</body>
</html>
