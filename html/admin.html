<div class="app">
  <h2>Admin Dashboard</h2>
  <ul id="ordersList"></ul>
</div>

<script type="module">
auth.onAuthStateChanged(user=>{
  if(!user) location.href="../index.html";
  db.collection("users").doc(user.uid).get().then(doc=>{
    if(!doc.exists || doc.data().role!=="admin"){ auth.signOut(); location.href="../index.html"; }
  });

  // Realtime pending orders
  db.collection("orders").where("status","==","pending").onSnapshot(snapshot=>{
    const ul=document.getElementById("ordersList");
    ul.innerHTML="";
    snapshot.forEach(doc=>{
      const d=doc.data();
      const li=document.createElement("li");
      li.innerHTML=`Order: ${d.pickup.lat.toFixed(5)},${d.pickup.lng.toFixed(5)} â†’ ${d.drop.lat.toFixed(5)},${d.drop.lng.toFixed(5)}
        | Customer: ${d.customerName} 
        <button onclick="approveOrder('${doc.id}')">Approve</button>`;
      ul.appendChild(li);
    });
  });
});

function approveOrder(orderId){
  db.collection("orders").doc(orderId).update({status:"approved"})
    .then(()=>alert("Order approved!"))
    .catch(err=>alert(err.message));
}
</script>
